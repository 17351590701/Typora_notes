## 前端按钮权限

### 方式一

==缺点，如果表格列没有东西，不能隐藏表格列==

#### 1.在directive目录下新建permission.ts文件

```ts
import { useUserStore } from "@/stores/user";
import type { Directive } from "vue";

//自定义按钮权限指令
export const permission: Directive = {
    mounted(el, binding) {
        const userStore = useUserStore()
        //按钮上权限字段
        const { value } = binding
        //当前用户的所有权限字段
        const permission = userStore.getCodeList
        if (value && value instanceof Array && value.length > 0) {
            const permissionRoles = value;
            const hasPermission = permission.some((role) => {
                return permissionRoles.includes(role)
            })
            //如果没有按钮权限，影藏按钮
            if(!hasPermission){
                el.style.display='none'
            }
        } else {
            throw new Error("按钮权限的传递方式v-permission=['sys:role:add']")
        }
    }

}
```

#### 2.在main.ts中直接引入

```ts
//按钮权限指令
import{permission}from '@/direvtive/permission'
app.directive('permission',permission)
```



#### 3.在菜单页面分配每个菜单的权限字段

![image-20240420153545221](https://gitee.com/yurun-zhang/typora-tu-chuang/raw/master/202406061740529.png)

#### 在按钮上绑定权限字段

```vue
<el-button v-permission="['sys:user:add']" icon="Plus" type="primary" @click="addBtn">新增</el-button>
```



### 方式二

==优势，可以隐藏不存在按钮的操作列==

#### 1.在direvtive目录下新建hasPerm.ts文件

```ts
import { useUserStore } from "@/stores/user";
export default function hasParam(value:any){
    const userStore = useUserStore();
    //当前用户拥有的权限字符
    const permissions = userStore.getCodeList;
    if(value&&value instanceof Array &&value.length>0){
        //按钮所需权限
        const permissionRoles =value
        //判断是否存在按钮所需权限
        const hasPermission =permissions.some(role=>{
            return permissionRoles.includes(role)
        })
        return hasPermission
    }else{
        throw new Error('v-if="global.$hasPerm("[\'add\',\'edit\']")')
    }

}
```

#### 2.在main.ts中引入

```ts
import  hasPerm  from '@/direvtive/hasPerm'
//全局挂载
app.config.globalProperties.$hasPerm = hasPerm
```

#### 3.在每个按钮上绑定hasPerm，同时为这个操作列绑定此数组

按钮：`v-if="global.$hasPerm(['sys:user:edit'])"`

操作列：`v-if="global.$hasPerm(['sys:user:edit','sys:user:reset','sys:user:delete'])"`

```vue
<el-table-column v-if="global.$hasPerm(['sys:user:edit','sys:user:reset','sys:user:delete'])" align="center" width="320" label="操作">
  <template #default="scope">
<el-button v-if="global.$hasPerm(['sys:user:edit'])" type="primary" size="default" icon="Edit"
           @click="editBtn(scope.row)">编辑</el-button>
<el-button v-if="global.$hasPerm(['sys:user:reset'])" type="warning" size="default" icon="Setting"
           @click="resetPasswordBtn(scope.row.userId)">重置密码</el-button>
<el-button v-if="global.$hasPerm(['sys:user:delete'])" type="danger" size="default" icon="Delete"
           @click="deleteBtn(scope.row.userId)">删除</el-button>
  </template>
</el-table-column>
```

