# 存储引擎

## 引擎对比

![image-20240510213814937](https://gitee.com/yurun-zhang/typora-tu-chuang/raw/master/202406061735628.png)

## 引擎选择

![image-20240511193618019](https://gitee.com/yurun-zhang/typora-tu-chuang/raw/master/202406061735629.png)

# 索引

## 索引结构

![image-20240510214910741](https://gitee.com/yurun-zhang/typora-tu-chuang/raw/master/202406061735630.png)

![image-20240510215834560](https://gitee.com/yurun-zhang/typora-tu-chuang/raw/master/202406061735631.png)

![image-20240510220655935](https://gitee.com/yurun-zhang/typora-tu-chuang/raw/master/202406061735632.png)

> myql改良B+tree
>
> 双向链表
>
> 叶子结点存储数据

![image-20240510220837598](https://gitee.com/yurun-zhang/typora-tu-chuang/raw/master/202406061735633.png)

![image-20240510221218690](https://gitee.com/yurun-zhang/typora-tu-chuang/raw/master/202406061735634.png)

![image-20240510221237473](https://gitee.com/yurun-zhang/typora-tu-chuang/raw/master/202406061735635.png)

## 思考



![image-20240510221616187](https://gitee.com/yurun-zhang/typora-tu-chuang/raw/master/202406061735636.png)

## 索引分类

![image-20240510221752613](https://gitee.com/yurun-zhang/typora-tu-chuang/raw/master/202406061735637.png)

> 聚焦索引：叶子节点存储行数据
>
> 二级索引：叶子节点存储主键

![image-20240510221923046](https://gitee.com/yurun-zhang/typora-tu-chuang/raw/master/202406061735638.png)

> select * from user where name = “Arm”;
>
> 查询二级索引，找到Arm的主键id为10，再到聚焦索引中根据id查询到行数据
>
> 所以:select * from user where id = 10; 效率更高

![image-20240510222051735](https://gitee.com/yurun-zhang/typora-tu-chuang/raw/master/202406061735639.png)



## 索引语法

创建索引

`create [UNIQUE|FULLTEXT] index index_name on table_name(index_col_name);`

查看索引

`show index from table_name;`

删除索引

`drop index index_name on table_name;`



### 案例

![image-20240511192427400](https://gitee.com/yurun-zhang/typora-tu-chuang/raw/master/202406061735640.png)

> 创建默认为B+tree结构

1. `create index idx_user_name on user(name);`

2. `create unique index idx_user_phone on user(phone);`

3. `create index idx_user_pro_age_sta on user(profession,age,status);`
4. `create index idx_user_email on user(email);`



## SQL性能分析

### SQL执行频率

查看操作类型频率，看是select为主还是insert,update等

`show global status like `

## 大数据分页查询优化

> 查询第1000000条后的50条数据
>
> limit x,y 
>
> x：偏移量（废数据）
>
> y：要查询条数

```mysql
select a.empno,
		 a.ename,
		 b.deptno
from emp e
	left join dept b
		on a.deptno = b.deptno
order by a.id desc
limit 1000000,50;
```

==优化==：索引覆盖+子查询

> 先查询第1000001条数据的id，根据id来查询往后的数据

```mysql
select a.empno,
		 a.ename,
		 b.deptno
from emp e
	left join dept b
		on a.deptno = b.deptno
where a.id >= (select id from emp order by id limit 1000000,1)
order by a.id 
limit 50;
```

